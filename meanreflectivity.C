{
auto tg_PENESRRef = new TGraph();
tg_PENESRRef->AddPoint(381.20754716981133, 27.71488469601677);
tg_PENESRRef->AddPoint(380.45283018867923, 22.68343815513627);
tg_PENESRRef->AddPoint(382.41509433962267, 36.60377358490566);
tg_PENESRRef->AddPoint(383.3207547169811, 46.16352201257862);
tg_PENESRRef->AddPoint(384.6792452830189, 55.55555555555556);
tg_PENESRRef->AddPoint(386.188679245283, 63.27044025157233);
tg_PENESRRef->AddPoint(387.54716981132077, 69.81132075471697);
tg_PENESRRef->AddPoint(389.9622641509434, 76.85534591194968);
tg_PENESRRef->AddPoint(392.9811320754717, 84.40251572327044);
tg_PENESRRef->AddPoint(395.24528301886795, 88.0922431865828);
tg_PENESRRef->AddPoint(397.9622641509434, 90.44025157232704);
tg_PENESRRef->AddPoint(400.9811320754717, 91.78197064989519);
tg_PENESRRef->AddPoint(404.60377358490564, 93.12368972746332);
tg_PENESRRef->AddPoint(409.7358490566038, 94.12997903563942);
tg_PENESRRef->AddPoint(412.90566037735846, 94.29769392033543);
tg_PENESRRef->AddPoint(417.7358490566038, 94.63312368972747);
tg_PENESRRef->AddPoint(421.35849056603774, 94.9685534591195);
tg_PENESRRef->AddPoint(425.1320754716981, 95.13626834381552);
tg_PENESRRef->AddPoint(428.90566037735846, 95.13626834381552);
tg_PENESRRef->AddPoint(433.4339622641509, 95.80712788259959);
tg_PENESRRef->AddPoint(438.1132075471698, 95.80712788259959);
tg_PENESRRef->AddPoint(442.188679245283, 95.80712788259959);
tg_PENESRRef->AddPoint(447.92452830188677, 96.14255765199162);
tg_PENESRRef->AddPoint(456.8301886792453, 96.31027253668763);
tg_PENESRRef->AddPoint(465.7358490566038, 96.81341719077568);
tg_PENESRRef->AddPoint(472.8301886792453, 96.47798742138365);
tg_PENESRRef->AddPoint(482.0377358490566, 96.9811320754717);

auto tg_PMTQE = new TGraph(); //https://hamamatsu.su/media/index/%3Ftype%3Dcatalog%26id%3D2&ved=2ahUKEwj788_UpMKHAxUuywIHHXl2MOEQFnoECBkQAQ&usg=AOvVaw3YgYwJulJerUMZFFa_FY5i
tg_PMTQE->AddPoint(274.87179487179486, 0.09849900773546232);
tg_PMTQE->AddPoint(283.0769230769231, 0.372759372031494);
tg_PMTQE->AddPoint(288.2051282051282, 1.4539905247440883);
tg_PMTQE->AddPoint(298.46153846153845, 3.340484983513244);
tg_PMTQE->AddPoint(305.64102564102564, 7.7915814643391785);
tg_PMTQE->AddPoint(317.94871794871796, 14.267615459606958);
tg_PMTQE->AddPoint(339.48717948717945, 21.140884460455894);
tg_PMTQE->AddPoint(374.35897435897436, 24.967366833985114);
tg_PMTQE->AddPoint(426.66666666666663, 24.967366833985114);
tg_PMTQE->AddPoint(485.1282051282051, 19.601189628919947);
tg_PMTQE->AddPoint(523.0769230769231, 14.485034710121479);
tg_PMTQE->AddPoint(547.6923076923076, 9.775698152536794);
tg_PMTQE->AddPoint(572.3076923076923, 6.498421570076716);
tg_PMTQE->AddPoint(590.7692307692307, 4.520353656360243);
tg_PMTQE->AddPoint(607.1794871794871, 2.7030588482581055);
tg_PMTQE->AddPoint(620.5128205128206, 1.743328822199988);
tg_PMTQE->AddPoint(640, 0.8563997244440057);
tg_PMTQE->AddPoint(656.4102564102564, 0.4676820901105864);
tg_PMTQE->AddPoint(667.6923076923076, 0.22974599398446502);
tg_PMTQE->AddPoint(680, 0.11116728815539267);
tg_PMTQE->AddPoint(691.2820512820513, 0.05628731194871122);
tg_PMTQE->AddPoint(702.5641025641025, 0.03027726099617869);

auto tg_PENESpec = new TGraph();

tg_PENESpec->AddPoint(344.92099322799095, 0.01881720430107527*100.);
tg_PENESpec->AddPoint(355.30474040632055, 0.01881720430107527*100.);
tg_PENESpec->AddPoint(363.882618510158, 0.05376344086021506*100.);
tg_PENESpec->AddPoint(368.8487584650113, 0.12634408602150538*100.);
tg_PENESpec->AddPoint(371.1060948081264, 0.20698924731182797*100.);
tg_PENESpec->AddPoint(374.7178329571106, 0.2741935483870968*100.);
tg_PENESpec->AddPoint(378.3295711060948, 0.32795698924731187*100.);
tg_PENESpec->AddPoint(380.58690744920995, 0.40860215053763443*100.);
tg_PENESpec->AddPoint(384.65011286681715, 0.4919354838709678*100.);
tg_PENESpec->AddPoint(388.71331828442436, 0.5618279569892474*100.);
tg_PENESpec->AddPoint(390.9706546275395, 0.631720430107527*100.);
tg_PENESpec->AddPoint(394.13092550790066, 0.696236559139785*100.);
tg_PENESpec->AddPoint(396.83972911963883, 0.7580645161290324*100.);
tg_PENESpec->AddPoint(400.90293453724604, 0.7983870967741936*100.);
tg_PENESpec->AddPoint(406.32054176072234, 0.8521505376344086*100.);
tg_PENESpec->AddPoint(414.8984198645598, 0.8521505376344086*100.);
tg_PENESpec->AddPoint(421.2189616252822, 0.8467741935483871*100.);
tg_PENESpec->AddPoint(426.6365688487585, 0.7983870967741936*100.);
tg_PENESpec->AddPoint(431.60270880361173, 0.739247311827957*100.);
tg_PENESpec->AddPoint(435.66591422121894, 0.6935483870967742*100.);
tg_PENESpec->AddPoint(437.92325056433407, 0.6478494623655915*100.);
tg_PENESpec->AddPoint(441.98645598194133, 0.5913978494623656*100.);
tg_PENESpec->AddPoint(447.40406320541763, 0.5295698924731184*100.);
tg_PENESpec->AddPoint(452.8216704288939, 0.47580645161290325*100.);
tg_PENESpec->AddPoint(456.88487584650113, 0.4059139784946237*100.);
tg_PENESpec->AddPoint(463.6568848758465, 0.3413978494623656*100.);
tg_PENESpec->AddPoint(470.4288939051919, 0.28225806451612906*100.);
tg_PENESpec->AddPoint(481.2641083521445, 0.20967741935483872*100.);
tg_PENESpec->AddPoint(488.9390519187359, 0.1532258064516129*100.);
tg_PENESpec->AddPoint(499.32279909706546, 0.11021505376344087*100.);
tg_PENESpec->AddPoint(515.1241534988714, 0.07526881720430108*100.);
tg_PENESpec->AddPoint(528.6681715575621, 0.05376344086021506*100.);
tg_PENESpec->AddPoint(542.2121896162528, 0.043010752688172046*100.);
tg_PENESpec->AddPoint(551.2415349887133, 0.03763440860215054*100.);
tg_PENESpec->AddPoint(559.3679458239278, 0.05376344086021506*100.);
tg_PENESpec->AddPoint(570.6546275395034, 0.06451612903225806*100.);
tg_PENESpec->AddPoint(581.038374717833, 0.048387096774193554*100.);
tg_PENESpec->AddPoint(590.0677200902935, 0.03225806451612903*100.);
tg_PENESpec->AddPoint(602.7088036117382, 0.016129032258064516*100.);
tg_PENESpec->AddPoint(614.8984198645599, 0.024193548387096777*100.);

TH1D *hdummy = new TH1D("hdummy","",10,300,550);
hdummy->GetYaxis()->SetRangeUser(0, 100);
hdummy->Draw();

tg_PENESRRef->SetMarkerStyle(2);
tg_PENESRRef->Draw("sameP");

tg_PENESpec->SetMarkerStyle(3);
tg_PENESpec->Draw("sameP");

tg_PMTQE->SetMarkerStyle(4);
tg_PMTQE->Draw("sameP");


TF1 *fgg = new TF1("fgg","[0]*([1]*TMath::Gaus(x,[2],[3],1) + (1.-[1])*TMath::Gaus(x,[4],[5],1))", 300, 600);
fgg->SetParameters(110.311, 0.507, 402, 19.67, 435.8, 28.3);
fgg->SetParLimits(1, 0.2, 0.8);
fgg->SetParLimits(2, 390, 410);
fgg->SetParLimits(3, 5, 50);
fgg->SetParLimits(4, 410, 450);
fgg->SetParLimits(5, 5, 50);
//tg_PENESpec->Fit("fgg","","",340,480);

TF1 *fref = new TF1("fref","[0]/(1 + exp(-[1]*(x-[2])))",300, 600);
fref->SetParameters(94.759, 0.273, 284.);
fref->SetParLimits(2, 360, 410);
fgg->DrawCopy("same");
TF1 *fPMT = new TF1("fPMT","gaus",300,600);
tg_PENESRRef->Fit("fref","","",340, 440);

fgg->SetParameter(0, 1.); // normalize

float nsamples = 60.;
float wstart = 340.;
float wend = 500;

float dw = (wend - wstart)/nsamples;

float averageR = 0.0, wl = 0.;
float norm = 0.;
for (int iw = 0; iw < nsamples; iw++){
	wl = wstart + float(iw) * dw;
	cout << wl << ", ";
	averageR = averageR + fgg->Eval(wl) * fref->Eval(wl)*dw;
	norm = norm + fgg->Eval(wl)*dw;
}
cout << endl;
averageR = averageR/norm;

cout << "Average reflectivity is " << averageR << endl;
cout << "Check normalization " << fgg->Integral(320,600) << endl;


}